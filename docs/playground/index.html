<!DOCTYPE html>
<meta charset="utf-8">
<style>textarea{width:49%;height:70vh} .row{display:flex;gap:1%}</style>
<h1>quartofmt playground</h1>
<label>
    Line width:
    <input id="lw" type="number" min="10" max="200" value="80">
</label>
<div class="row">
    <textarea id="input" placeholder="Paste Quartoâ€¦"></textarea>
    <textarea id="output" readonly></textarea>
</div>
<pre id="debug" style="white-space:pre-wrap"></pre>
<script type="module">
  import init, { format_qmd, tokenize_debug } from './pkg/quartofmt_wasm.js';
  await init();
  const $ = id => document.getElementById(id);
  const fmt = () => {
    const inp = $('input').value;
    const lw = parseInt($('lw').value || '80', 10);
    $('output').value = format_qmd(inp, lw);
    // Optional debug:
    // $('debug').textContent = tokenize_debug(inp);
    // Update URL for sharing
    const params = new URLSearchParams({ lw: String(lw) });
    history.replaceState(null, '', '?' + params.toString());
  };
  $('input').addEventListener('input', fmt);
  $('lw').addEventListener('input', fmt);
  // Load defaults from URL
  const q = new URLSearchParams(location.search);
  if (q.get('lw')) $('lw').value = q.get('lw');
  $('input').value = '---\ntitle: Demo\n---\n\nThis is a very long line that should be wrapped.\n\n```{r}\nprint(1)\n```\n\n$$\nA &= B \\\\\nC &= D\n$$\n';
  fmt();
</script>
